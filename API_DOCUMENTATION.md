# üìä API Documentation - Mes Frais

Cette documentation pr√©sente une API REST compl√®te pour la gestion de frais personnels et budgets familiaux. L'API permet de g√©rer des comptes bancaires, op√©rations financi√®res, pr√©l√®vements automatiques, revenus r√©currents et projections budg√©taires.

## üèóÔ∏è Architecture et Relations

### Mod√®le de Donn√©es Hi√©rarchique :
```
User (Utilisateur Django)
‚îú‚îÄ‚îÄ Account (Compte bancaire)
‚îÇ   ‚îú‚îÄ‚îÄ Operation (Op√©ration financi√®re)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DirectDebit (Pr√©l√®vement - h√©rite d'Operation)
‚îÇ   ‚îú‚îÄ‚îÄ RecurringIncome (Revenu r√©current)
‚îÇ   ‚îî‚îÄ‚îÄ BudgetProjection (Projection budg√©taire)
```

### Relations Cl√©s :
- **User ‚Üí Account** : Un utilisateur peut avoir plusieurs comptes
- **Account ‚Üí Operation** : Un compte a plusieurs op√©rations (1-N)
- **Operation ‚Üí DirectDebit** : Les pr√©l√®vements sont des op√©rations sp√©cialis√©es (h√©ritage)
- **Account ‚Üí RecurringIncome** : Un compte peut avoir plusieurs revenus r√©currents (1-N)
- **Account ‚Üí BudgetProjection** : Un compte peut avoir plusieurs projections (1-N)

## üîê Authentification & S√©curit√©

**Syst√®me d'authentification :** Token JWT requis pour toutes les routes
**Base URL :** `/api/`
**Isolation des donn√©es :** Chaque utilisateur acc√®de uniquement √† ses propres donn√©es
**Permissions Staff :** Les utilisateurs staff peuvent acc√©der √† toutes les donn√©es

### Headers requis :
```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

## üéØ Conventions G√©n√©rales

### Formats de Donn√©es :
- **IDs** : Entiers positifs
- **Montants** : Strings avec d√©cimales (`"1250.75"`) pour pr√©cision financi√®re
- **Dates** : Format ISO `YYYY-MM-DD`
- **Timestamps** : Format ISO `YYYY-MM-DDTHH:MM:SSZ`
- **Bool√©ens** : `true`/`false`

### Codes de R√©ponse HTTP :
- **200** : Succ√®s (GET, PUT, PATCH)
- **201** : Cr√©√© (POST)
- **204** : Succ√®s sans contenu (DELETE)
- **400** : Erreur de validation
- **401** : Non authentifi√©
- **403** : Acc√®s interdit
- **404** : Ressource non trouv√©e

## üìã R√©sum√© des Endpoints (49 routes total)

| Mod√®le | Routes CRUD | Actions Sp√©cialis√©es | Total |
|--------|-------------|---------------------|-------|
| **Account** | 5 | 5 | 10 |
| **Operation** | 5 | 3 | 8 |
| **DirectDebit** | 5 | 7 | 12 |
| **RecurringIncome** | 5 | 6 | 11 |
| **BudgetProjection** | 5 | 3 | 8 |

### Actions les Plus Importantes pour un LLM :
1. **`GET /accounts/`** - Point d'entr√©e principal
2. **`GET /accounts/{id}/statistics/`** - R√©sum√© d'un compte
3. **`GET /budget-projections/dashboard/`** - Vue d'ensemble compl√®te
4. **`POST /budget-projections/calculate/`** - Projections temps r√©el
5. **`GET /operations/search/`** - Recherche avanc√©e d'op√©rations

### Logique des Relations :
- **User** ‚Üê has many ‚Üí **Account** ‚Üê has many ‚Üí **Operation/DirectDebit/RecurringIncome/BudgetProjection**
- **DirectDebit** IS-A **Operation** (h√©ritage)
- Toutes les modifications d'**Operation** mettent √† jour **Account.solde** automatiquement

---

## üè¶ 1. ACCOUNTS (Comptes Bancaires)

**Entit√© racine** : Repr√©sente un compte bancaire appartenant √† un utilisateur.

**Base route:** `/api/accounts/`
**Mod√®le Django:** `Account`
**Relations:**
- Appartient √† : `User` (propri√©taire du compte)
- Contient : `Operation[]`, `DirectDebit[]`, `RecurringIncome[]`, `BudgetProjection[]`

**Champs principaux:**
- `id` (integer, auto) : Identifiant unique
- `user` (foreign key) : Propri√©taire du compte
- `nom` (string, max 100 chars) : Nom du compte
- `solde` (decimal) : Solde actuel (mis √† jour automatiquement)
- `created_by` (foreign key) : Utilisateur qui a cr√©√© le compte
- `created_at/updated_at` (datetime) : Timestamps automatiques

### üìã Routes CRUD Standard

#### **GET** `/api/accounts/` - Liste des comptes
**Query Parameters:**
```json
{
  "user": "integer (optionnel)",
  "created_by": "integer (optionnel)",
  "search": "string (optionnel)",
  "ordering": "string (solde, created_at, updated_at)"
}
```

**Response:**
```json
[
  {
    "id": 1,
    "user_username": "john_doe",
    "nom": "Compte courant",
    "solde": "1250.75",
    "operations_count": 15,
    "updated_at": "2024-01-15T10:30:00Z"
  }
]
```

#### **POST** `/api/accounts/` - Cr√©er un compte
**Body:**
```json
{
  "user": 1,
  "nom": "Nouveau compte",
  "solde": "1000.00"
}
```

**Response:**
```json
{
  "id": 2,
  "user": 1,
  "user_username": "john_doe",
  "nom": "Nouveau compte",
  "solde": "1000.00",
  "created_by": 1,
  "created_by_username": "john_doe",
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

#### **GET** `/api/accounts/{id}/` - D√©tail d'un compte
**Response:** Structure identique au POST response

#### **PUT/PATCH** `/api/accounts/{id}/` - Modifier un compte
**Body:**
```json
{
  "nom": "Compte modifi√©",
  "solde": "1500.00"
}
```

#### **DELETE** `/api/accounts/{id}/` - Supprimer un compte
**Response:** `204 No Content` (si aucune op√©ration li√©e)

### üéØ Actions Personnalis√©es

#### **GET** `/api/accounts/{id}/operations/` - Op√©rations du compte
**Response:**
```json
{
  "account_id": 1,
  "account_username": "john_doe",
  "operations": [...],
  "total_operations": 15
}
```

#### **GET** `/api/accounts/{id}/statistics/` - Statistiques du compte
**Response:**
```json
{
  "account_id": 1,
  "account_username": "john_doe",
  "solde_actuel": 1250.75,
  "statistics": {
    "total_operations": 15,
    "total_montant_operations": 2500.50,
    "operations_30_jours": 5,
    "montant_30_jours": 300.00,
    "pr√©l√®vements_actifs": 3,
    "montant_pr√©l√®vements": -450.00
  }
}
```

#### **POST** `/api/accounts/{id}/adjust_balance/` - Ajuster le solde
**Body:**
```json
{
  "montant": "100.00",
  "raison": "Ajustement manuel"
}
```

#### **GET** `/api/accounts/summary/` - R√©sum√© de tous les comptes
**Response:**
```json
{
  "total_comptes": 3,
  "total_solde": 5000.75,
  "comptes_negatifs": 1,
  "comptes_positifs": 2
}
```

#### **GET** `/api/accounts/global_overview/` - Vue d'ensemble globale
**Response:** Donn√©es compl√®tes pour dashboard avec d√©tails par compte

---

## üí∞ 2. OPERATIONS (Op√©rations Financi√®res)

**Entit√© de transaction** : Repr√©sente une transaction financi√®re sur un compte (cr√©dit ou d√©bit).

**Base route:** `/api/operations/`
**Mod√®le Django:** `Operation`
**Relations:**
- Appartient √† : `Account` (compte de r√©f√©rence)
- Parent de : `DirectDebit` (pr√©l√®vement automatique)

**Champs principaux:**
- `id` (integer, auto) : Identifiant unique
- `compte_reference` (foreign key) : Compte concern√© par l'op√©ration
- `montant` (decimal) : Montant de l'op√©ration (positif=cr√©dit, n√©gatif=d√©bit)
- `description` (string, max 255 chars) : Description de l'op√©ration
- `date_operation` (date, auto) : Date de l'op√©ration
- `created_by` (foreign key) : Utilisateur qui a cr√©√© l'op√©ration

**Logique m√©tier :**
- Le solde du compte est automatiquement mis √† jour lors des op√©rations CRUD
- Les montants peuvent √™tre positifs (revenus) ou n√©gatifs (d√©penses)
- Validation : montant ne peut pas √™tre z√©ro

### üìã Routes CRUD Standard

#### **GET** `/api/operations/` - Liste des op√©rations
**Query Parameters:**
```json
{
  "compte_reference": "integer (optionnel)",
  "created_by": "integer (optionnel)",
  "search": "string (optionnel)",
  "ordering": "string (montant, created_at, updated_at)"
}
```

**Response:**
```json
[
  {
    "id": 1,
    "compte_reference_username": "john_doe",
    "montant": "250.00",
    "description": "Salaire",
    "created_at": "2024-01-15T10:30:00Z"
  }
]
```

#### **POST** `/api/operations/` - Cr√©er une op√©ration
**Body:**
```json
{
  "compte_reference": 1,
  "montant": "250.00",
  "description": "Virement re√ßu"
}
```

**Response:**
```json
{
  "id": 2,
  "compte_reference": 1,
  "compte_reference_username": "john_doe",
  "montant": "250.00",
  "description": "Virement re√ßu",
  "created_by": 1,
  "created_by_username": "john_doe",
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

#### **PUT/PATCH** `/api/operations/{id}/` - Modifier une op√©ration
**Body:** Structure identique au POST

#### **DELETE** `/api/operations/{id}/` - Supprimer une op√©ration
**Response:** `204 No Content` (solde automatiquement ajust√©)

### üéØ Actions Personnalis√©es

#### **GET** `/api/operations/statistics/` - Statistiques des op√©rations
**Response:**
```json
{
  "statistics": {
    "total_operations": 50,
    "total_montant": 12500.75,
    "operations_30_jours": 15,
    "montant_30_jours": 3500.25,
    "operations_7_jours": 5,
    "montant_7_jours": 750.00,
    "operations_positives": 30,
    "montant_positif": 15000.00,
    "operations_negatives": 20,
    "montant_negatif": -2500.00
  }
}
```

#### **GET** `/api/operations/by_account/` - Op√©rations group√©es par compte
**Response:**
```json
[
  {
    "account_id": 1,
    "account_username": "john_doe",
    "operations_count": 15,
    "total_montant": 2500.75,
    "operations": [...]
  }
]
```

#### **GET** `/api/operations/search/` - Recherche avanc√©e
**Query Parameters:**
```json
{
  "q": "string (optionnel)",
  "min_montant": "decimal (optionnel)",
  "max_montant": "decimal (optionnel)",
  "date_debut": "date YYYY-MM-DD (optionnel)",
  "date_fin": "date YYYY-MM-DD (optionnel)"
}
```

#### **POST** `/api/operations/bulk_create/` - Cr√©er plusieurs op√©rations
**Body:**
```json
{
  "operations": [
    {
      "compte_reference": 1,
      "montant": "100.00",
      "description": "Achat 1"
    },
    {
      "compte_reference": 1,
      "montant": "-50.00",
      "description": "Achat 2"
    }
  ]
}
```

---

## üîÑ 3. DIRECT-DEBITS (Pr√©l√®vements Automatiques)

**Entit√© sp√©cialis√©e** : H√©rite d'Operation, repr√©sente des pr√©l√®vements r√©currents automatiques.

**Base route:** `/api/direct-debits/`
**Mod√®le Django:** `DirectDebit` (h√©rite d'`Operation`)
**Relations:**
- H√©rite de : `Operation` (toutes les propri√©t√©s + champs sp√©cialis√©s)
- Appartient √† : `Account` (via Operation.compte_reference)

**Champs sp√©cialis√©s (en plus d'Operation):**
- `date_prelevement` (date) : Date du premier pr√©l√®vement
- `echeance` (date, nullable) : Date de fin des pr√©l√®vements (null = illimit√©)
- `frequence` (enum) : "Mensuel", "Trimestriel", "Annuel"
- `actif` (boolean, default=true) : Statut actif/inactif

**Logique m√©tier :**
- Calculs automatiques des prochaines occurrences selon la fr√©quence
- Validation : date_prelevement et echeance ne peuvent pas √™tre dans le pass√©
- Validation : echeance doit √™tre >= date_prelevement
- M√©thodes disponibles : `get_next_occurrence()`, `get_occurrences_until(date)`

### üìã Routes CRUD Standard

#### **GET** `/api/direct-debits/` - Liste des pr√©l√®vements
**Query Parameters:**
```json
{
  "compte_reference": "integer (optionnel)",
  "created_by": "integer (optionnel)",
  "search": "string (optionnel)",
  "ordering": "string (montant, date_prelevement, echeance, created_at)"
}
```

**Response:**
```json
[
  {
    "id": 1,
    "compte_reference_username": "john_doe",
    "montant": "150.00",
    "description": "Abonnement internet",
    "date_prelevement": "2024-02-01",
    "echeance": null,
    "is_active": true,
    "created_at": "2024-01-15T10:30:00Z"
  }
]
```

#### **POST** `/api/direct-debits/` - Cr√©er un pr√©l√®vement
**Body:**
```json
{
  "compte_reference": 1,
  "montant": "150.00",
  "description": "Abonnement mensuel",
  "date_prelevement": "2024-02-01",
  "echeance": "2024-12-31",
  "frequence": "Mensuel"
}
```

**Response:**
```json
{
  "id": 2,
  "compte_reference": 1,
  "compte_reference_username": "john_doe",
  "montant": "150.00",
  "description": "Abonnement mensuel",
  "date_prelevement": "2024-02-01",
  "echeance": "2024-12-31",
  "created_by": 1,
  "created_by_username": "john_doe",
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z",
  "is_active": true
}
```

**Choix pour `frequence`:**
- `"Mensuel"`
- `"Trimestriel"`
- `"Annuel"`

#### **PUT/PATCH** `/api/direct-debits/{id}/` - Modifier un pr√©l√®vement
**Body:** Structure identique au POST (sans compte_reference)

#### **DELETE** `/api/direct-debits/{id}/` - Supprimer un pr√©l√®vement
**Response:** `204 No Content`

### üéØ Actions Personnalis√©es

#### **GET** `/api/direct-debits/active/` - Pr√©l√®vements actifs
**Response:**
```json
{
  "active_count": 5,
  "pr√©l√®vements_actifs": [...]
}
```

#### **GET** `/api/direct-debits/expired/` - Pr√©l√®vements expir√©s
**Response:**
```json
{
  "expired_count": 2,
  "pr√©l√®vements_expir√©s": [...]
}
```

#### **GET** `/api/direct-debits/upcoming/` - Pr√©l√®vements √† venir (30 jours)
**Response:**
```json
{
  "upcoming_count": 3,
  "pr√©l√®vements_√†_venir": [...]
}
```

#### **GET** `/api/direct-debits/statistics/` - Statistiques des pr√©l√®vements
**Response:**
```json
{
  "statistics": {
    "total_pr√©l√®vements": 10,
    "total_montant": 1500.00,
    "pr√©l√®vements_actifs": 8,
    "montant_actifs": 1200.00,
    "pr√©l√®vements_expir√©s": 2,
    "montant_expir√©s": 300.00,
    "pr√©l√®vements_ce_mois": 5,
    "montant_ce_mois": 750.00
  }
}
```

#### **GET** `/api/direct-debits/by_account/` - Pr√©l√®vements par compte
**Response:** Groupement par compte avec statistiques

#### **POST** `/api/direct-debits/{id}/extend/` - Prolonger l'√©ch√©ance
**Body:**
```json
{
  "nouvelle_echeance": "2025-12-31"
}
```

#### **POST** `/api/direct-debits/bulk_update_status/` - Mise √† jour en lot
**Body:**
```json
{
  "ids": [1, 2, 3],
  "actif": false
}
```

---

## üíµ 4. RECURRING-INCOMES (Revenus R√©currents)

**Entit√© de revenu** : Repr√©sente des revenus r√©currents (salaires, subventions, aides, etc.).

**Base route:** `/api/recurring-incomes/`
**Mod√®le Django:** `RecurringIncome`
**Relations:**
- Appartient √† : `Account` (compte de destination)

**Champs principaux:**
- `id` (integer, auto) : Identifiant unique
- `compte_reference` (foreign key) : Compte de destination du revenu
- `montant` (decimal, positif) : Montant du revenu
- `description` (string, max 255 chars) : Description du revenu
- `date_premier_versement` (date) : Date du premier versement
- `date_fin` (date, nullable) : Date de fin des versements (null = illimit√©)
- `frequence` (enum) : "Hebdomadaire", "Mensuel", "Trimestriel", "Annuel"
- `actif` (boolean, default=true) : Statut actif/inactif
- `type_revenu` (enum) : "Salaire", "Subvention", "Aide", "Pension", "Loyer", "Autre"

**Logique m√©tier :**
- Calculs automatiques des prochaines occurrences selon la fr√©quence
- Conversion automatique en √©quivalent mensuel pour les projections
- Validation : montant doit √™tre positif
- Validation : dates coh√©rentes (date_fin >= date_premier_versement)
- M√©thodes disponibles : `get_next_occurrence()`, `get_occurrences_until(date)`

### üìã Routes CRUD Standard

#### **GET** `/api/recurring-incomes/` - Liste des revenus
**Query Parameters:**
```json
{
  "compte_reference": "integer (optionnel)",
  "type_revenu": "string (optionnel)",
  "frequence": "string (optionnel)",
  "actif": "boolean (optionnel)",
  "search": "string (optionnel)",
  "ordering": "string (montant, date_premier_versement, created_at)"
}
```

**Response:**
```json
[
  {
    "id": 1,
    "compte_reference_username": "john_doe",
    "montant": "2500.00",
    "description": "Salaire principal",
    "date_premier_versement": "2024-01-01",
    "date_fin": null,
    "frequence": "Mensuel",
    "type_revenu": "Salaire",
    "is_active": true,
    "next_occurrence": "2024-02-01",
    "created_at": "2024-01-15T10:30:00Z"
  }
]
```

#### **POST** `/api/recurring-incomes/` - Cr√©er un revenu
**Body:**
```json
{
  "compte_reference": 1,
  "montant": "2500.00",
  "description": "Salaire mensuel",
  "date_premier_versement": "2024-02-01",
  "date_fin": null,
  "frequence": "Mensuel",
  "actif": true,
  "type_revenu": "Salaire"
}
```

**Choix pour `type_revenu`:**
- `"Salaire"`
- `"Subvention"`
- `"Aide"`
- `"Pension"`
- `"Loyer"`
- `"Autre"`

**Choix pour `frequence`:**
- `"Hebdomadaire"`
- `"Mensuel"`
- `"Trimestriel"`
- `"Annuel"`

**Response:**
```json
{
  "id": 2,
  "compte_reference": 1,
  "compte_reference_username": "john_doe",
  "montant": "2500.00",
  "description": "Salaire mensuel",
  "date_premier_versement": "2024-02-01",
  "date_fin": null,
  "frequence": "Mensuel",
  "actif": true,
  "type_revenu": "Salaire",
  "created_by": 1,
  "created_by_username": "john_doe",
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z",
  "is_active": true,
  "next_occurrence": "2024-02-01"
}
```

#### **PUT/PATCH** `/api/recurring-incomes/{id}/` - Modifier un revenu
**Body:** Structure identique au POST (sans compte_reference)

#### **DELETE** `/api/recurring-incomes/{id}/` - Supprimer un revenu
**Response:** `204 No Content`

### üéØ Actions Personnalis√©es

#### **GET** `/api/recurring-incomes/statistics/` - Statistiques des revenus
**Response:**
```json
{
  "statistics": {
    "total_revenus": 5,
    "revenus_actifs": 4,
    "montant_mensuel_equivalent": 3500.00,
    "montant_annuel_equivalent": 42000.00,
    "par_type": {
      "Salaire": {"count": 2, "montant_total": 5000.00},
      "Subvention": {"count": 1, "montant_total": 500.00}
    },
    "par_frequence": {
      "Mensuel": 3,
      "Trimestriel": 1
    }
  }
}
```

#### **GET** `/api/recurring-incomes/by_account/` - Revenus par compte
**Response:** Groupement par compte avec montants √©quivalents mensuels

#### **GET** `/api/recurring-incomes/active/` - Revenus actifs uniquement
**Response:**
```json
{
  "count": 4,
  "revenus": [...]
}
```

#### **GET** `/api/recurring-incomes/upcoming/` - Prochaines occurrences
**Query Parameters:**
```json
{
  "days": "integer (d√©faut: 30)"
}
```

**Response:**
```json
{
  "periode": "30 jours",
  "count": 3,
  "revenus": [
    {
      "id": 1,
      "description": "Salaire principal",
      "type_revenu": "Salaire",
      "montant": 2500.00,
      "date_occurrence": "2024-02-01",
      "jours_restants": 15,
      "compte": "Compte courant"
    }
  ]
}
```

#### **GET** `/api/recurring-incomes/projections/` - Projections de revenus
**Query Parameters:**
```json
{
  "mois": "integer (d√©faut: 12)"
}
```

#### **POST** `/api/recurring-incomes/{id}/toggle_active/` - Activer/d√©sactiver
**Response:** Statut mis √† jour

#### **POST** `/api/recurring-incomes/bulk_create/` - Cr√©er plusieurs revenus
**Body:**
```json
{
  "revenus": [
    {
      "compte_reference": 1,
      "montant": "2500.00",
      "description": "Salaire",
      "type_revenu": "Salaire",
      "frequence": "Mensuel"
    }
  ]
}
```

---

## üìà 5. BUDGET-PROJECTIONS (Projections Budg√©taires)

**Entit√© analytique** : Stocke et calcule des projections budg√©taires sur plusieurs mois.

**Base route:** `/api/budget-projections/`
**Mod√®le Django:** `BudgetProjection`
**Relations:**
- Appartient √† : `Account` (compte analys√©)
- Utilise : `DirectDebit[]`, `RecurringIncome[]` (pour les calculs)

**Champs principaux:**
- `id` (integer, auto) : Identifiant unique
- `compte_reference` (foreign key) : Compte analys√©
- `date_projection` (date) : Date de d√©but de la projection
- `periode_projection` (integer, 1-60) : Nombre de mois √† projeter
- `solde_initial` (decimal, auto) : Solde au moment de la cr√©ation
- `projections_data` (JSON, auto) : Donn√©es calcul√©es de la projection

**Logique m√©tier complexe :**
- Calculs automatiques int√©grant pr√©l√®vements et revenus r√©currents
- Projections mensuelles avec √©volution du solde
- Analyses statistiques (solde min/max, mois en n√©gatif, etc.)
- Support de diff√©rents sc√©narios (optimiste, pessimiste, r√©aliste)
- Contrainte unique : (compte_reference, date_projection, periode_projection)

**Structure projections_data (JSON) :**
```json
{
  "compte_id": integer,
  "solde_initial": decimal,
  "projections_mensuelles": [
    {
      "mois": integer,
      "solde_debut": decimal,
      "solde_fin": decimal,
      "total_revenus": decimal,
      "total_prelevements": decimal,
      "transactions": [...]
    }
  ],
  "resume": {
    "revenus_totaux": decimal,
    "solde_minimum": decimal,
    "mois_solde_negatif": integer
  }
}
```

### üìã Routes CRUD Standard

#### **GET** `/api/budget-projections/` - Liste des projections
**Query Parameters:**
```json
{
  "compte_reference": "integer (optionnel)",
  "periode_projection": "integer (optionnel)",
  "search": "string (optionnel)",
  "ordering": "string (date_projection, created_at)"
}
```

#### **POST** `/api/budget-projections/` - Cr√©er une projection
**Body:**
```json
{
  "compte_reference": 1,
  "date_projection": "2024-02-01",
  "periode_projection": 12
}
```

**Response:** Projection cr√©√©e avec calculs automatiques inclus

#### **GET** `/api/budget-projections/{id}/` - D√©tail d'une projection
**Response:** Projection compl√®te avec toutes les donn√©es calcul√©es

#### **PUT/PATCH** `/api/budget-projections/{id}/` - Modifier une projection
**Body:** Structure identique au POST

#### **DELETE** `/api/budget-projections/{id}/` - Supprimer une projection
**Response:** `204 No Content`

### üéØ Actions Personnalis√©es

#### **POST** `/api/budget-projections/calculate/` - Calcul temps r√©el
**Body:**
```json
{
  "compte_reference": 1,
  "date_debut": "2024-02-01",
  "periode_mois": 6,
  "inclure_prelevements": true,
  "inclure_revenus": true
}
```

**Response:**
```json
{
  "compte_id": 1,
  "compte_nom": "Compte courant",
  "solde_initial": 1250.75,
  "solde_final_projete": 3500.25,
  "variation_totale": 2249.50,
  "date_debut": "2024-02-01",
  "date_fin": "2024-08-01",
  "periode_mois": 6,
  "projections_mensuelles": [
    {
      "mois": 1,
      "date_debut": "2024-02-01",
      "date_fin": "2024-02-29",
      "solde_debut": 1250.75,
      "solde_fin": 1600.75,
      "total_revenus": 2500.00,
      "total_prelevements": 2150.00,
      "variation": 350.00,
      "transactions": [...]
    }
  ],
  "resume": {
    "revenus_totaux": 15000.00,
    "prelevements_totaux": 12750.50,
    "solde_minimum": 850.25,
    "solde_maximum": 3500.25,
    "mois_solde_negatif": 0
  }
}
```

#### **GET** `/api/budget-projections/summary/` - R√©sum√© budg√©taire
**Query Parameters:**
```json
{
  "compte_id": "integer (optionnel)"
}
```

**Response:** R√©sum√© complet ou par compte sp√©cifique

#### **GET** `/api/budget-projections/dashboard/` - Tableau de bord
**Query Parameters:**
```json
{
  "periode_mois": "integer (d√©faut: 3, max: 60)"
}
```

**Response:**
```json
{
  "user_id": 1,
  "periode_projection": 3,
  "indicateurs_cles": {
    "solde_total_actuel": 5000.75,
    "nombre_comptes": 3,
    "revenus_mensuels_estimes": 3500.00,
    "prelevements_mensuels_estimes": 2750.00,
    "solde_mensuel_estime": 750.00,
    "projection_3_mois": 7250.75
  },
  "activite_recente": {
    "operations_7j": {...},
    "operations_30j": {...},
    "operations_90j": {...}
  },
  "repartition_comptes": [...],
  "alertes": [...]
}
```

#### **POST** `/api/budget-projections/quick_projection/` - Projection rapide
**Body:**
```json
{
  "compte_id": 1,
  "mois": 3,
  "scenario": "optimiste"
}
```

#### **GET** `/api/budget-projections/compare_scenarios/` - Comparaison de sc√©narios
**Query Parameters:**
```json
{
  "compte_id": "integer",
  "periode": "integer (d√©faut: 6)"
}
```

---

## üö´ Codes d'Erreur Communs

### 400 Bad Request
```json
{
  "error": "Donn√©es invalides",
  "details": {
    "montant": ["Le montant ne peut pas √™tre z√©ro."],
    "description": ["La description ne peut pas √™tre vide."]
  }
}
```

### 401 Unauthorized
```json
{
  "error": "Authentication credentials were not provided."
}
```

### 403 Forbidden
```json
{
  "error": "Vous ne pouvez pas acc√©der √† ce compte"
}
```

### 404 Not Found
```json
{
  "error": "Compte non trouv√©"
}
```

### 500 Internal Server Error
```json
{
  "error": "Erreur interne du serveur"
}
```

---

## üìù Guide d'Impl√©mentation pour LLM

### üß† Compr√©hension du Contexte M√©tier

**Domaine :** Application de gestion financi√®re personnelle
**Objectif :** Permettre aux utilisateurs de suivre leurs finances, pr√©voir leurs budgets
**Public :** Particuliers g√©rant leurs comptes bancaires et budgets familiaux

**Workflow typique d'utilisation :**
1. Cr√©er un ou plusieurs comptes bancaires (`/accounts/`)
2. Enregistrer des op√©rations financi√®res (`/operations/`)
3. Configurer des pr√©l√®vements automatiques (`/direct-debits/`)
4. D√©finir des revenus r√©currents (`/recurring-incomes/`)
5. G√©n√©rer des projections budg√©taires (`/budget-projections/`)

### üîÑ Logique de Mise √† Jour Automatique

**Cascade de mise √† jour des soldes :**
```
Operation CREATE/UPDATE/DELETE ‚Üí Account.solde mis √† jour automatiquement
DirectDebit (h√©rite Operation) ‚Üí M√™me comportement
```

**Calculs en temps r√©el :**
- Projections budg√©taires recalcul√©es √† chaque demande
- Statistiques agr√©g√©es dynamiquement
- Conversions de fr√©quences automatiques (hebdo ‚Üí mensuel, etc.)

### üéØ Patterns d'Usage Recommand√©s

**Pour un LLM assistant :**

1. **Consultation de donn√©es :**
   - Toujours commencer par `/accounts/` pour le contexte utilisateur
   - Utiliser `/statistics/` pour les r√©sum√©s
   - Pr√©f√©rer `/summary/` et `/dashboard/` pour les vues d'ensemble

2. **Cr√©ation de donn√©es :**
   - Valider l'existence du compte avant cr√©er operations/pr√©l√®vements/revenus
   - Utiliser `/bulk_create/` pour les op√©rations multiples
   - Les IDs sont auto-g√©n√©r√©s, ne jamais les sp√©cifier en cr√©ation

3. **Recherche et filtrage :**
   - Utiliser les query parameters pour filtrer (`?compte_reference=1`)
   - `/search/` endpoints pour recherche textuelle
   - `/by_account/` pour grouper par compte

4. **Projections et analyses :**
   - `/calculate/` pour projections temporaires (pas de sauvegarde)
   - POST `/budget-projections/` pour sauvegarder des projections
   - `/dashboard/` pour aper√ßu complet de la situation financi√®re

### ‚ö†Ô∏è Contraintes et Validations Critiques

**Contraintes m√©tier absolues :**
- Les montants d'op√©ration ne peuvent pas √™tre z√©ro
- Les soldes de compte ne peuvent pas √™tre n√©gatifs √† la cr√©ation
- Les dates de pr√©l√®vement/√©ch√©ance ne peuvent pas √™tre dans le pass√©
- Un utilisateur ne peut acc√©der qu'√† ses propres donn√©es (sauf staff)

**Validations automatiques :**
- Coh√©rence des dates (date_fin >= date_debut)
- Format des montants (decimal avec 2 d√©cimales max)
- Unicit√© des projections (compte + date + p√©riode)

### üèóÔ∏è Architecture Technique

**Framework :** Django REST Framework avec ViewSets
**Base de donn√©es :** PostgreSQL recommand√© pour les calculs d√©cimaux
**H√©ritage :** DirectDebit h√©rite d'Operation (table unique avec discriminateur)
**Permissions :** IsAuthenticated + filtrage par utilisateur dans get_queryset()

**Endpoints standards par mod√®le :**
- `GET /` : Liste (avec pagination)
- `POST /` : Cr√©ation
- `GET /{id}/` : D√©tail
- `PUT/PATCH /{id}/` : Modification
- `DELETE /{id}/` : Suppression

**Actions personnalis√©es :**
- Pattern `@action(detail=True)` pour actions sur une instance
- Pattern `@action(detail=False)` pour actions sur la collection
- Suffixes courants : `/statistics/`, `/summary/`, `/active/`, `/upcoming/`

### üìä Donn√©es de Test et Exemples

**Comptes typiques :**
- Compte courant (solde quotidien)
- Livret A (√©pargne)
- Compte joint (famille)

**Op√©rations courantes :**
- Salaire : +2500‚Ç¨ mensuel
- Loyer : -800‚Ç¨ mensuel  
- Courses : -300‚Ç¨ mensuel (variable)
- Essence : -200‚Ç¨ mensuel

**Pr√©l√®vements automatiques :**
- Abonnements : t√©l√©phone, internet, assurances
- Cr√©dits : immobilier, voiture
- Utilities : √©lectricit√©, gaz, eau

### üöÄ Optimisations de Performance

**Pour les LLMs :**
- Utiliser les endpoints `/summary/` plut√¥t que r√©cup√©rer toutes les donn√©es
- Pr√©f√©rer les vues agr√©g√©es aux calculs c√¥t√© client
- Limiter les appels API avec les filtres appropri√©s
- Utiliser `/dashboard/` pour les vues d'ensemble compl√®tes

**Gestion de la pagination :**
```http
GET /api/operations/?limit=50&offset=0
GET /api/operations/?page=2  (si pagination par page activ√©e)
```

Cette documentation est optimis√©e pour qu'un LLM comprenne parfaitement le contexte m√©tier, les relations entre entit√©s, et puisse utiliser l'API de mani√®re efficace et coh√©rente. 